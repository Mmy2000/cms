{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% load number_filters %}



{% block title %} ูุงุฆูุฉ ุญุณุงุจุงุช ุงูุฏูุบุงุช ุงููุชููุนู {% endblock %}

{% block content %}
<div class="mt-10">
{% include "includes/alerts.html" %}
</div>

    <div class="mt-10 flex flex-col gap-2 md:flex-row justify-between items-center">
            <a href="{% url 'add_expected_stamp' %}"
        class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all">
            โ  ุฅุถุงูุฉ ุญุณุงุจ ุฏูุบุฉ ูุชููุนู
        </a>
        <a href="{% url 'grouped_expected_stamps' %}" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-all">ูุฌููุนุฉ ุญุณุจ ุงูุดุฑูุฉ</a>
    </div>
     <div>
        <form method="GET" class="mt-6 gap-4 flex items-center justify-center sm:justify-start">
            <!-- Preserve filters -->
            <input type="hidden" name="sector" value="{{ sector_filter }}">
            <input type="hidden" name="date_from" value="{{ date_from }}">
            <input type="hidden" name="date_to" value="{{ date_to }}">
            <input type="hidden" name="sort" value="{{ request.GET.sort }}">
            
            <select name="download" class="select select-success">
                <option value="">ุชุญููู ูู...</option>
                <option value="pdf">๐ PDF</option>
                <option value="excel">๐ Excel</option>
            </select>

            <button name="download_btn" value="1"
                class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all">
                ุชุญููู
            </button>
        </form>
    </div>
    <div class="bg-white shadow-xl rounded-xl overflow-hidden mt-6 border border-gray-200">
    <!-- ุงูุนููุงู -->
    <div class="overflow-auto flex flex-col md:flex-row items-center justify-between bg-gradient-to-l from-green-100 to-green-50 border-b border-green-200 px-6 py-4 ">
        <div class="flex flex-col md:flex-row items-center md:gap-2 md:w-1/4">
        <h2 class="text-xl font-bold text-green-800 ">
            ๐ฐ ุฅุฌูุงูู ุงูุฏูุบุฉ ุจุงูููููู:
            <div class="text-green-900 text-2xl text-center">{{ total_all_sectors|millions }}</div>
        </h2>
        </div>

        <form method="GET" class="flex gap-4 items-center md:justify-center  flex-wrap mt-2 md:mt-0 md:w-3/4">
            <div class="flex flex-wrap w-full md:w-1/4 justify-center">
            <select name="sector" class="select select-success">
                <option value="">ูู ุงููุทุงุนุงุช</option>
                {% for s in sectors %}
                    <option value="{{ s.id }}" {% if sector_filter == s.id|stringformat:"s" %}selected{% endif %}>
                        {{ s.name }} 
                    </option>
                {% endfor %}
            </select>
            </div>

            <!-- From date -->
            <div class="flex flex-wrap gap-4 w-full md:w-auto justify-center">
                <div class="flex flex-col ">
                    <label class="text-sm font-semibold text-gray-600 mb-2">ูู ุชุงุฑูุฎ</label>
                    <input type="date"
                        name="date_from"
                        value="{{ date_from }}"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>

                <!-- To date -->
                <div class="flex flex-col ">
                    <label class="text-sm font-semibold text-gray-600 mb-2">ุฅูู ุชุงุฑูุฎ</label>
                    <input type="date"
                        name="date_to"
                        value="{{ date_to }}"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <div class="flex gap-4 flex-wrap w-full md:w-auto justify-center">
                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-all">
                    ุจุญุซ ๐
                </button>

                <!-- ุฒุฑ Reset -->
                <a href="{% url 'expected_stamp_list' %}"
                class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400">
                    ุฅุนุงุฏุฉ ุงูุชุนููู ๐
                </a>
            </div>

        </form>

    </div>

    <div class="overflow-auto max-h-[600px]">
    <table class="min-w-full text-right border border-gray-200">
        <thead class="bg-gray-100 text-gray-700 sticky top-0 z-10 shadow-sm">
            <tr class="text-sm lg:text-lg font-bold">
                <th class="p-3 border border-gray-200">ุงููุทุงุน</th>
                <th class="p-3 border border-gray-200">
                    ุชุงุฑูุฎ ุงููุนุงููู  
                    <a href="?{% querystring request sort='invoice_date' %}">โฌ๏ธ</a>
                    <a href="?{% querystring request sort='-invoice_date' %}">โฌ๏ธ</a>
                </th>
                <th class="p-3 border border-gray-200">ูููุฉ ุงูุฃุนูุงู</th>
                <th class="p-3 border border-gray-200">ุนุฏุฏ ุงููุณุฎ</th>
                <th class="p-3 border border-gray-200">ุงููุณุจุฉ</th>
                <th class="p-3 border border-gray-200">ุฅุฌูุงูู ุงูุฏูุบู ูููุทุงูุจุฉ</th>
            </tr>
        </thead>

        <tbody>
            {% for s in page_obj %}
            <tr class="hover:bg-gray-50 transition-all font-medium text-lg">
                <td class="p-3 border border-gray-200 "><a href="{% url 'expected_stamp_detail' s.id %}">{{ s.sector.name }}</a></td>
                <td class="p-3 border border-gray-200 ">{{ s.invoice_date|date:"Y-m-d" }}</td>
                <td class="p-3 border border-gray-200">{{ s.value_of_work|millions }}</td>
                <td class="p-3 border border-gray-200">{{ s.invoice_copies }}</td>
                <td class="p-3 border border-gray-200">{{ s.stamp_rate }}</td>
                <td class="p-3 border border-gray-200  text-blue-700">{{ s.d1|millions }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center p-6 border border-gray-200 text-gray-500">
                    ูุง ุชูุฌุฏ ุจูุงูุงุช ุญุชู ุงูุขู.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination -->
    {% if page_obj.has_other_pages %}
    <div class="flex justify-center items-center gap-2 py-4">
        {% if page_obj.has_previous %}
            <a href="?{% querystring request page=page_obj.previous_page_number %}"
               class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">โน ุงูุณุงุจู</a>
        {% endif %}

        <span class="px-4 py-1 bg-green-100 text-green-800 rounded">
            ุงูุตูุญุฉ {{ page_obj.number }} ูู {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?{% querystring request page=page_obj.next_page_number %}"
               class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">ุงูุชุงูู โบ</a>
        {% endif %}
    </div>
    {% endif %}
</div>

</div>

<div class="mt-8">
        <h2 class="text-2xl font-bold text-green-800 ">
            ๐ฐ ุงููุนุงุด ุงููุชููุน ุจุงูููููู :<span class="text-green-900 text-2xl">{{ total_pension|millions }}</span>
        </h2>
    </div>



{% endblock %}
